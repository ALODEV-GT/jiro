<div class="min-h-screen bg-base-200 p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-base-content">Mi Proyecto - Board</h1>
    <button class="btn btn-primary" (click)="openCreateTaskModal()">
      + Nueva tarea
    </button>
  </div>

  <!-- Columnas con drag & drop horizontal -->
  <div
    class="flex gap-6 overflow-x-auto pb-4"
    cdkDropList
    cdkDropListOrientation="horizontal"
    [cdkDropListData]="columns"
    (cdkDropListDropped)="dropColumn($event)"
    id="columns-drop-list"
  >
    @for (column of columns; track column.id; let i = $index) {
      <div
        class="flex-shrink-0 w-80 bg-base-100 rounded-lg shadow-md border border-base-300 flex flex-col"
        cdkDrag
        [cdkDragData]="column"
      >
        <!-- Header de columna -->
        <div class="p-4 border-b border-base-300 flex justify-between items-center select-none">
          <div class="flex items-center gap-2">
            <!-- Handle para mover columna -->
            <div
              cdkDragHandle
              class="cursor-grab p-1 rounded hover:bg-base-200 text-base-content/60"
              title="Arrastrar columna"
            >
              <span class="text-lg leading-none">⋮⋮</span>
            </div>

            <div class="flex items-center gap-2">
              <h3 class="font-semibold text-base-content">{{ column.title }}</h3>
              <span class="badge badge-sm badge-ghost">{{ column.tasks.length }}</span>
            </div>
          </div>

          <div class="flex items-center gap-1">
            <button class="btn btn-ghost btn-xs" (click)="editColumnName(column)">
              Edit
            </button>
            @if (columns.length > 1) {
              <button class="btn btn-ghost btn-xs text-error" (click)="deleteColumn(column.id)">
                Delete
              </button>
            }
          </div>
        </div>

        <!-- Lista de tareas (drag & drop entre columnas) -->
        <div
          class="flex-1 min-h-96 p-4 space-y-3"
          cdkDropList
          [id]="'task-list-' + column.id"
          [cdkDropListData]="column.tasks"
          [cdkDropListConnectedTo]="taskListIds"
          (cdkDropListDropped)="dropTask($event, column.id)"
        >
          @for (task of column.tasks; track task.id) {
            <div
              cdkDrag
              [cdkDragData]="task"
              class="bg-base-200 p-4 rounded-lg border border-base-300 shadow-sm hover:shadow-md transition-shadow"
            >
              <div class="font-medium text-base-content">{{ task.title }}</div>

              @if (task.description) {
                <p class="text-sm text-base-content/70 mt-1">
                  {{ task.description }}
                </p>
              }

              <div class="flex justify-between items-center mt-3">
                <div class="badge badge-primary badge-sm">{{ task.id }}</div>
                <button
                  class="btn btn-ghost btn-xs text-error"
                  (click)="deleteTask(column.id, task.id)"
                >
                  Delete
                </button>
              </div>
            </div>
          }
        </div>

        <!-- Footer -->
        <div class="p-4 border-t border-base-300">
          <button
            class="text-sm text-base-content/70 hover:text-primary w-full text-left"
            (click)="openCreateTaskModal(column.id)"
          >
            + Agregar tarea
          </button>
        </div>
      </div>
    }

    <!-- Add new column -->
    <div class="flex-shrink-0 w-80">
      <button
        class="btn btn-ghost w-full h-32 border-2 border-dashed border-base-300 text-base-content/60 hover:border-primary hover:text-primary"
        (click)="addColumn()"
      >
        + Agregar otra columna
      </button>
    </div>
  </div>
</div>

<!-- Modal create task -->
<div class="modal" [class.modal-open]="isModalOpen">
  <div class="modal-box">
    <h3 class="text-lg font-bold">Nueva tarea</h3>
    <form (ngSubmit)="createTask()" class="space-y-4 mt-4">
      <div class="form-control">
        <label class="label"><span class="label-text">Título</span></label>
        <input
          type="text"
          name="title"
          [(ngModel)]="newTask.title"
          class="input input-bordered"
          required
        />
      </div>

      <div class="form-control">
        <label class="label"><span class="label-text">Descripción (opcional)</span></label>
        <textarea
          name="description"
          [(ngModel)]="newTask.description"
          class="textarea textarea-bordered h-24"
        ></textarea>
      </div>

      <div class="form-control">
        <label class="label"><span class="label-text">Columna</span></label>
        <select
          name="column"
          class="select select-bordered w-full"
          [(ngModel)]="newTask.columnId"
        >
          @for (column of columns; track column.id) {
            <option [value]="column.id">{{ column.title }}</option>
          }
        </select>
      </div>

      <div class="modal-action">
        <button type="button" class="btn" (click)="closeModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">Crear tarea</button>
      </div>
    </form>
  </div>
</div>
