<div class="min-h-screen bg-base-200 p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-base-content">Mi Proyecto - Board</h1>
    <button class="btn btn-primary" (click)="openCreateTaskModal()">
      + Nueva tarea
    </button>
  </div>

  <!-- BOARD CON REORDEN DE COLUMNAS -->
  <div 
    class="flex gap-6 overflow-x-auto pb-4" 
    cdkDropList
    cdkDropListOrientation="horizontal"
    [cdkDropListData]="columns"
    (cdkDropListDropped)="dropColumn($event)"
    cdkDropListGroup
  >
    @for (column of columns; track column.id) {
      <!-- COLUMNA (ahora también arrastrable) -->
      <div
        cdkDrag
        class="flex-shrink-0 w-80 bg-base-100 rounded-lg shadow-md border border-base-300 flex flex-col cursor-move"
        cdkDragPreviewClass="shadow-2xl rounded-lg"
      >
        <!-- Contenido de la columna (igual que antes) -->
        <div
          class="flex flex-col h-full"
          cdkDropList
          [cdkDropListData]="column.tasks"
          (cdkDropListDropped)="dropTask($event, column.id)"
        >
          <!-- Header de columna -->
          <div class="p-4 border-b border-base-300 flex justify-between items-center select-none">
            <div class="flex items-center gap-2">
              <h3 class="font-semibold text-base-content">{{ column.title }}</h3>
              <span class="badge badge-sm badge-ghost">{{ column.tasks.length }}</span>
            </div>
            <div class="flex items-center gap-1">
              <button class="btn btn-ghost btn-xs" (click)="editColumnName(column)">Edit</button>
              @if (columns.length > 1) {
                <button class="btn btn-ghost btn-xs text-error" (click)="deleteColumn(column.id)">Delete</button>
              }
            </div>
          </div>

          <!-- Tareas -->
          <div class="flex-1 min-h-96 p-4 space-y-3">
            @for (task of column.tasks; track task.id) {
              <div
                cdkDrag
                class="bg-base-200 p-4 rounded-lg border border-base-300 shadow-sm hover:shadow-md transition-shadow"
                cdkDragPreviewClass="drag-preview"
              >
                <div class="font-medium text-base-content">{{ task.title }}</div>
                @if (task.description) {
                  <p class="text-sm text-base-content/70 mt-1">{{ task.description }}</p>
                }
                <div class="flex justify-between items-center mt-3">
                  <div class="badge badge-primary badge-sm">{{ task.id }}</div>
                  <button class="btn btn-ghost btn-xs text-error" (click)="deleteTask(column.id, task.id)">Delete</button>
                </div>
              </div>
            }
            <div cdkDragPlaceholder class="h-24 bg-base-300/30 border-2 border-dashed rounded-lg"></div>
          </div>

          <!-- Footer -->
          <div class="p-4 border-t border-base-300">
            <button class="text-sm text-base-content/70 hover:text-primary w-full text-left" 
                    (click)="openCreateTaskModal(column.id)">
              + Agregar tarea
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Botón + Nueva columna (fuera del drag) -->
    <div class="flex-shrink-0 w-80">
      <button
        class="btn btn-ghost w-full h-32 border-2 border-dashed border-base-300 text-base-content/60 hover:border-primary hover:text-primary"
        (click)="addColumn()"
      >
        + Agregar otra columna
      </button>
    </div>
  </div>
</div>

<!-- Modal crear tarea (sin cambios) -->
<div class="modal" [class.modal-open]="isModalOpen">
  <div class="modal-box">
    <h3 class="text-lg font-bold">Nueva tarea</h3>
    <form (ngSubmit)="createTask()" class="space-y-4 mt-4">
      <div class="form-control">
        <label class="label"><span class="label-text">Título</span></label>
        <input type="text" [(ngModel)]="newTask.title" class="input input-bordered" required />
      </div>
      <div class="form-control">
        <label class="label"><span class="label-text">Descripción (opcional)</span></label>
        <textarea [(ngModel)]="newTask.description" class="textarea textarea-bordered h-24"></textarea>
      </div>
      <div class="modal-action">
        <button type="button" class="btn" (click)="closeModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">Crear tarea</button>
      </div>
    </form>
  </div>
</div>